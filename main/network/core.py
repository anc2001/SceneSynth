# Full implementation of the model end to end 